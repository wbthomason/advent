#! /usr/bin/env racket
#lang racket

(require racket/string)

(define input (string-split "fzostwblnqkhpuzxirnevmaycq fzastwblgqkupujxirnevmaucd fzostwbxgakhpujxirnevmayci uzosmwblgqkhlujxirnevmaycd bzostwblgqkhpujxirnenfaycd fzostwblghkhpujxibneemaycd fzostwblgrkkpujxirnevqaycd fzostwblgqkhpkjxirqkvmaycd fzostwblgqdxpujbirnevmaycd fzostwblgykhfujxirfevmaycd fzostwbvgskhpujxirnevmagcd flostwblgokhpuixirnevmaycd fzostwblgzkhppjxirnevxaycd ftosuwblgqkhpujxirnevmeycd fzostkblgqkzpujxirnrvmaycd fuostwbugqkhnujxirnevmaycd frostwblgqkhpujsirneamaycd bzostwblgqkhpajxirnevmuycd fzysttbluqkhpujxirnevmaycd czostgblgqkhpujxirnevmgycd fzostwbcgqkhpujxirnevmavcr vzostwbdgqrhpujxirnevmaycd fzostwblgxkhpujxirnekmdycd fzostwblgdkspzjxirnevmaycd fzoqtwblgquhpujxirnevkaycd fzostwblgqjhfujxirnevmayzd fyostwblgtkhpujxilnevmaycd izostwblzqkhpupxirnevmaycd fzoaurblgqkhpujxirnevmaycd fzostjblgqkhpbjxirbevmaycd fzostwblgqkhpujmirngvmayca fxostwbhgqkhiujxirnevmaycd fzostwblngkhpujxirnemmaycd fzosgwblgqkhpujxirnlvqaycd bpostwblgqkhxujxirnevmaycd fzhstwblgqshpujxirnepmaycd fzootwbegqkhwujxirnevmaycd fzmstwblgqkhmujxirnevsaycd fzostwolgqkhpujxirnevmaysp foostwblgqohpujxirnevmayyd fzostwblgqkhgujxgrnevqaycd fzostwbltqkhjujxipnevmaycd fsostwblgqkhfujxirnevmayck fzostwmlgqkbpujxifnevmaycd fdostwblgqkhsujxirnecmaycd fzostwblgquhpejxiinevmaycd fzoqtwblgqkhkujxirnevmaywd fzostwblmqkmpujxirnyvmaycd fzjstwblgqkhpuyxirneomaycd fzortwblgqkhpzjxprnevmaycd fzosnwulgqkhpujxirnevpaycd fzostwbegqkvpujxirnevmaykd fzostwylzqkypujxirnevmaycd fioshwblgqehpujxirnevmaycd fzostwbliqkhoujxirnesmaycd fzostwblgqkhpujdirnelmqycd fzmstwblgqkhpujxirnnvpaycd fzostwbtgqkhcujxirnevmaycz fzostwblgqkfpujeignevmaycd fzostwbegqkhpuvxirndvmaycd fzostwblgqkcpujxmrnevmaycp fvostwblgqkhpyjxirnevmaycx fzostwblgqkhpufxirnevmzacd fzisjwblglkhpujxirnevmaycd fzosowbliqkhgujxirnevmaycd fzostwblgqkhpujxirnyvmaywl fzostwbllqnzpujxirnevmaycd fzostwblgquhpujxirneomayci fzostwblgqjepujximnevmaycd fzostwblgqrhbujxijnevmaycd fzostoblgqkhpujxirnevmoynd fzortwblgqkhpujxixnevjaycd fzostwhlgqkapujxirnevmaych fzostwblgakhpujxirnevfayct faostwblgqohpljxirnevmaycd fzostwbhgqkhpujxirnyvcaycd fjostwblgqkhpwjxirnevjaycd fzostwblgqklpuixirnevmayxd fzostwblgqkhhujxirncvmayce fzostwblzqkhpzjxkrnevmaycd fzostwblqqkbpujxirnevmcycd ffostwblxqkhpujxirnevmayxd fzostwblgqkhpbuxirnefmaycd szostiblgqkhpujxirnevoaycd fhlstwblgqkhpujxirnevmaycb fzostwblgwfhpujxirnevmayed fyostwblgqkhzujxirnevmayjd fzostwblgqkvrujxirnevmaucd fzestwblghkhpujxirnevmaycq foostwbkgqkhhujxirnevmaycd fpxstwblgqkhpujxirzevmaycd fsostwtlgqmhpujxirnevmaycd feostwelgqkhpumxirnevmaycd fzostwbvgqkhpujkirnevmayce fzmsewblgqahpujxirnevmaycd fzsstsblgkkhpujxirnevmaycd fzostwblgqkhxajxirneumaycd fzostwblmqkhpujyisnevmaycd gzostwblgqkhphjxirnevmavcd fzostwblgckgpujxirnzvmaycd qzostdblgqkhpujxirnevmaywd fzoshwblgskhpufxirnevmaycd fzosdwblgqkhpujkirnevjaycd fzvstwblgqkhpuixdrnevmaycd szostwblgqxhpujeirnevmaycd fzosvwblgtkhpujxirnevmoycd fzoscwblgqkkpujxirnevmvycd fzostsblgqnlpujxirnevmaycd fzostwblgmkhpujxlrnevjaycd fzosnwblgqklpugxirnevmaycd fcostwblgqpmpujxirnevmaycd ozostwblgbkhpujxirnevmafcd fzostwbagqkhiujxirneemaycd fzosxwblgqkhpumxirneymaycd fpostkblgqkhpujxianevmaycd fzostwblgvkhhujxirnevmaycl fzobtwtlgqkhpuwxirnevmaycd fzostwvwgqkhpujxirtevmaycd xzostwglgqkhpujtirnevmaycd fzostwblgvkhtujxirnzvmaycd jzostwblgqkhpujxirrevmvycd pzostwbagqkhpujxirnevjaycd fzostwclgqkhpujxirnhvmeycd fzostwblglkhpujxirnevmayrf fzoskwblnqkhpujxirnevmaysd fzostbblgqkhpujxirnevmjycw fzostwblggobpujxirnevmaycd fzostwblgckhpijxirnevmayxd fiostwrlgqkhpujxirnevmayck frfstwblvqkhpujxirnevmaycd fzowvwblgqkhpujsirnevmaycd fzostwblgquhgujxirnevmiycd fzoztwblgqkhpujxvrnevmaycj fzostnbtgqkhpujxixnevmaycd fzfstwblgjkrpujxirnevmaycd fzostwblpqkhpdrxirnevmaycd fivstwblgqkhpuixdrnevmaycd fzostwbpgqkhpdjxirnewmaycd fzostwblgqkhpdjxsrngvmaycd fzostwblsqkhpujxisnxvmaycd fcosvwblgqkhpujxirnevmavcd fzostwrlgekhgujxirnevmaycd fzostwblgqkhpujxindeimaycd uzostwblgqshpujxirnevmwycd fzostwzliqkhpujxirnevmaycu zzostwbtgqkhpijxirnevmaycd fzoltwblgqkhpujxinncvmaycd fzostwblgqkzpujxprnevmayhd fqostwblgqkhpujrirnevmzycd jzostwblgqkhpuzxkrnevmaycd fzostwblgqkhpuwxirszvmaycd fzostwblgqkhpxjxilnevdaycd fpmstwblgqkhpujxirnwvmaycd fzoejwblqqkhpujxirnevmaycd fzostwblgkshzujxirnevmaycd fzoatqblgqxhpujxirnevmaycd fzostwblgpkhpujiipnevmaycd fzostwblgqghpujgbrnevmaycd izosowblgqkhpujxirnejmaycd fzostwblgqthpujxjrnevmalcd fzovtwbcgqkhpujxicnevmaycd fzoatwblgqkhpujxidntvmaycd kzpstwblgqihpujxirnevmaycd fzosawnlgqkhpujxibnevmaycd fzostwblgqkhpujxarnevdajcd bzostwblgqkhpujxvrnevmrycd fzostwblgqkhpwfxirnevmazcd fzostwblgqknpujyiqnevmaycd zzostwblgqkhpujyirneqmaycd flosiwblgqihpujxirnevmaycd fzoetwblgqkhxujxirnevmeycd fznstwbugqkhpujxibnevmaycd fzbstwblgqkhpudxitnevmaycd fzostwblgqkhkujxirnexaaycd fzohthblgqkhpujxiknevmaycd fzostwblgqkhpujxirnevvayjt fzostwblggkhpujxirnrvqaycd fzostwblgqslpujxirnevmaysd aoostwblgqkhpnjxirnevmaycd fzostwblgqkhlutxirnevuaycd fxostwbugqkhpujxirnexmaycd fzoftwblgqkhpsjxirnevmaywd fzbstwblgqkhndjxirnevmaycd fzostwblgqkhpxjxipnlvmaycd fzostwbloqkhowjxirnevmaycd fzostwblgqkcpdjxirnevnaycd vzostiblgqkhpsjxirnevmaycd fzostwblgqkhazjxirnevmaycg fzostaklgqkhpujxirnevmaypd fzostwblgkkhppjxirnevpaycd izostwblgqkhpujairhevmaycd fzostwdlgqkhpuqxzrnevmaycd fzostwblgqkepujxernevmayct fzostdblgqkhpujxyrnehmaycd fzostwblgqkhsujxirnenfaycd fzostwblgqkhpujxifnevmajld fzostwblgokhpujxirxemmaycd fzastwblcqkhpujxiruevmaycd fzostwsxgqkhpuexirnevmaycd xzosxwblgqkhpujxirnetmaycd fzostwblgqkhpuexirnevmkccd fzostwblgqklpujxirnermfycd fzoetwblgqkhpujxirnehhaycd ffostwblgvkhpujxirnevmazcd fcosywblgqkhpujxirnevmaycy fzmstwblgqkhpujxdrnevmaycl fpostwblgqahpujxirnqvmaycd fzostwbmgqkhpulxornevmaycd fzostwblgqkopujxqrnevmrycd fzostwblgqkhpujxisnevmjgcd fzogtwulfqkhpujxirnevmaycd fzostwalgqkhpcjxirnevmayud fzosxwblgqkhpujxirnevmasmd fzostwblgrkowujxirnevmaycd fzostsblgqkhpujxirnevmsccd fzostwblgqkhpujxfrnnvmaocd fzostwblgqkhpujxiynsvkaycd fzosowblgqkhpwjxirnevmaecd fzosgwblgfkhpujxyrnevmaycd fzostsblgzkhpujmirnevmaycd fzostwblrqkhyuixirnevmaycd qzostwblgqkhpujxyrnevmvycd lzostwblgqkhpujxirqevmaymd fzostwblgqkbpujxirnefbaycd fzostwblgmihpujxirnevmafcd fzostmblgqkhpujxirnevmpynd fzoltwblgqkhpujlihnevmaycd fzostwblgqkhpujdirneviyycd fzgspwblgqkhpqjxirnevmaycd fzostwblgqkhtujkirnevmayld fjostwblgqkhpagxirnevmaycd fzpsthblgqkhpuzxirnevmaycd fzostwblgqkhpuhxzrneymaycd fzoftwblgqkepujxirnevcaycd fzostwblgqkbpyjxipnevmaycd fzostwqlgqkhpujxirjevmayad fzoxtwblgqkypupxirnevmaycd fzostwblgqwhpuoxiynevmaycd fzostwblgqkhpfjkirnevmavcd fzoqtwblgqkhpujxirnermaycp fzostwbngxkhpujxirnevmayqd fzostwqogqkhpcjxirnevmaycd fzostwblyqkhpujxvrnevmayzd vzostwblgqkhpujxirnevmlzcd fzostwblaqkhpujxirnevbajcd fdostwblgqkhpujxzrnevmayod fzostxbloqkhpujxirnevmcycd fzostwbcgqkhpyjxirnegmaycd fzostwblgqkhpuyxirnzrmaycd fzustwycgqkhpujxirnevmaycd" " "))

(define test-input '("abcdef" "bababc" "abbcde" "abcccd" "aabcdd" "abcdee" "ababab"))
(define test-input2 '("abcde" "fghij" "klmno" "pqrst" "fguij" "axcye" "wvxyz"))

(define (count-2-3 id acc)
  (let* ([groups (group-by identity (string->list id))]
         [2s (ormap (lambda (x) (= (length x) 2)) groups)]
         [3s (ormap (lambda (x) (= (length x) 3)) groups)])
    (list (if 2s (+ 1 (car acc)) (car acc)) (if 3s (+ 1 (cadr acc)) (cadr acc)))))

(define (part1 ids) 
  (apply * (foldl count-2-3 (list 0 0) ids)))

(define (similar? id1 id2)
  (let* ([charset1 (map cons (string->list id1) (range (string-length id1)))]
         [charset2 (map cons (string->list id2) (range (string-length id2)))]
         [diff (set-symmetric-difference charset1 charset2)]
         [indices (apply set (set-map diff (lambda (x) (cdr x))))])
    (if (= 1 (set-count indices))
        (string-replace id1 (string (string-ref id1 (set-first indices))) "")
        #f)))

(define (part2 ids)
  (define (looper to-go)
    (let* ([curr (car to-go)]
           [sim (ormap (lambda (id) (similar? curr id)) (cdr to-go))])
    (if sim sim (looper (cdr to-go)))))
  (looper ids))

(printf "Part 1: ~a\n" (part1 input))
(printf "Similar: ~a\n" (similar? "fghij" "fguij"))
(printf "Part 2: ~a\n" (part2 input))
